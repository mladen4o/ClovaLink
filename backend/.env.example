# ============================================================================
# ClovaLink Backend Environment Configuration
# ============================================================================
# Copy this file to .env and customize for your deployment.
# DO NOT commit your .env file to version control!
# ============================================================================

# ============================================================================
# STORAGE CONFIGURATION
# ============================================================================
# Storage backend: "local" for filesystem, "s3" for S3-compatible storage
STORAGE_TYPE=local

# Local storage path (used when STORAGE_TYPE=local)
# UPLOADS_PATH=/app/uploads

# S3 Configuration (required if STORAGE_TYPE=s3)
# S3_BUCKET=clovalink-files
# S3_REGION=us-east-1
# S3_ENDPOINT=https://s3.us-east-1.amazonaws.com
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL connection URL
# Format: postgres://user:password@host:port/database
DATABASE_URL=postgres://postgres:password@localhost:5432/clovalink

# Connection Pool Settings
DB_MAX_CONNECTIONS=50
DB_MIN_CONNECTIONS=10
DB_ACQUIRE_TIMEOUT_SECS=5
DB_IDLE_TIMEOUT_SECS=600
DB_MAX_LIFETIME_SECS=1800

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
# Redis connection URL for caching and session storage
REDIS_URL=redis://localhost:6379

# ============================================================================
# SECURITY
# ============================================================================
# JWT signing secret - CHANGE THIS IN PRODUCTION!
# Generate with: openssl rand -base64 32
JWT_SECRET=CHANGE-ME-IN-PRODUCTION-use-openssl-rand-base64-32

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
# Port to run the backend server on
PORT=3000

# Environment: development or production
ENVIRONMENT=production

# Logging level: trace, debug, info, warn, error
RUST_LOG=info

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
# Enable CORS dev mode (allows all origins) - DISABLE IN PRODUCTION
CORS_DEV_MODE=false

# Allowed origins (comma-separated) - required when CORS_DEV_MODE=false
CORS_ALLOWED_ORIGINS=https://app.yourcompany.com

# ============================================================================
# CDN / PRESIGNED URLS (Optional)
# ============================================================================
# Enable presigned URLs for direct S3 downloads (reduces server load)
USE_PRESIGNED_URLS=false

# Presigned URL expiry time in seconds (default: 1 hour)
# PRESIGNED_URL_EXPIRY_SECS=3600

# CDN domain for serving files (optional)
# CDN_DOMAIN=cdn.yourcompany.com

# ============================================================================
# S3 REPLICATION (Enterprise - Optional)
# ============================================================================
# Enable async replication to secondary S3 bucket for durability
REPLICATION_ENABLED=false

# Secondary S3 bucket configuration (required if REPLICATION_ENABLED=true)
# REPLICATION_ENDPOINT=https://s3.us-west-2.amazonaws.com
# REPLICATION_BUCKET=clovalink-backup
# REPLICATION_REGION=us-west-2
# REPLICATION_ACCESS_KEY=your-backup-access-key
# REPLICATION_SECRET_KEY=your-backup-secret-key

# Replication mode: "backup" (uploads only) or "mirror" (uploads + deletes)
# REPLICATION_MODE=backup

# Retry interval for failed replications (seconds)
# REPLICATION_RETRY_SECONDS=60

# Number of concurrent replication workers
# REPLICATION_WORKERS=4

# ============================================================================
# CLAMAV VIRUS SCANNING
# ============================================================================
# Enable ClamAV virus scanning for uploaded files
CLAMAV_ENABLED=true

# ClamAV daemon host and port
CLAMAV_HOST=localhost
CLAMAV_PORT=3310

# Scan timeout in milliseconds
CLAMAV_TIMEOUT_MS=30000

# Number of concurrent scan workers
CLAMAV_WORKERS=4

# Maximum file size to scan (MB) - larger files are skipped
CLAMAV_MAX_FILE_SIZE_MB=100

# Maximum pending scan jobs (backpressure control, 0=unlimited)
CLAMAV_MAX_QUEUE_SIZE=10000

# ============================================================================
# RATE LIMITING / BACKPRESSURE
# ============================================================================
# Maximum concurrent requests the server will handle
MAX_CONCURRENT_REQUESTS=1000

# Request timeout in seconds (increase for large file uploads)
REQUEST_TIMEOUT_SECS=300

# Per-IP rate limiting
PER_IP_REQUESTS_PER_SEC=100
PER_IP_BURST_SIZE=200

# Circuit breaker configuration
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_SECS=30

# ============================================================================
# FILE TRANSFER SCHEDULER
# ============================================================================
# Concurrent transfer limits by file size category
TRANSFER_SMALL_CONCURRENT=50
TRANSFER_MEDIUM_CONCURRENT=20
TRANSFER_LARGE_CONCURRENT=5

# Bandwidth limit for large file transfers (Mbps)
TRANSFER_LARGE_BANDWIDTH_MBPS=50

# ============================================================================
# EXTENSIONS
# ============================================================================
# Timeout for extension webhook calls (milliseconds)
EXTENSION_WEBHOOK_TIMEOUT_MS=5000

# ============================================================================
# MONITORING (Optional)
# ============================================================================
# Enable API usage tracking (stores request metrics in database)
# API_USAGE_TRACKING=true
